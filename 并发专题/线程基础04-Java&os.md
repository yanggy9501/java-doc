# 线程基础知识

## 1. 线程和进程

### 1.1 概念

**进程：** 进程是os资源（cpu，内存等）分配的基本单位，就是程序的一次运行。

**线程：**是操作系统调度 （CPU调度）执行的最小单位。

**关系：**线程是进程中的实体，是线程的实际运行，一个进程可以拥有多个线程，一个线程必须有一个父进程。

![image-20220319172107261](asserts/image-20220319172107261.png)

**区别：**

*   进程与进程之间是相互独立的，同一个进程内的线程，可以存在联系的。
*   通信方式不同
    *   线程通信相对简单，线程天然的共享内存，多个线程可以访问同一 个共享变量就可以完成通信。
    *   进程间通信：
        *   同一计算机通信的
        *   不同计算机通信：需要通过网络协议，如：http
    *   进程和线程的切换：进程切换有上下文环境的切换，线程的切换则不需要

### 1.2 进程间通信

*   **管道通信**

    >   管道好比一个文件，一端往文件上写内容，另一端读取文件的内容。
    >
    >   同一计算机进程间的通信

*   **消息队列**

    >   利用消息队列完成进程间通信，例如：rabbitmq，kafka等等
    >
    >   可实现不同计算机通信

*   **共享内存**

    >   多个进 程可以访问同一块内存空间。
    >
    >   这种方式需要依靠某种同步操作，如互斥锁和信号量等。
    >
    >   同一计算机进程间的通信

*   **信号量**

    >   进程之间及同一种进程的不同线程之间得同步和互斥手段。

*   **套接字**

    >   可用于网络中不同机器之间的进程间通信。

### 1.3 线程同步互斥

>   线程的同步互斥是线程之间的一种相互制约的关系（执行顺序）。

#### 1.3.1 临界关系相关概念

**临界资源：**多进程共享的互资源（这些资源不能被线程任意的共享）

**临界区：**访问临界资源的代码

### 1.4 上下文切换

>   上下文切换是指CPU(中央处理单元)从一个进程或线程到另一个进程或线程的切换。
>
>   存在的进行环境的保存和恢复，代价比较大。

## 2，线程的生命周期

不同语言和操作系统在描述线程生命周期是可能有一些不同。

### 2.1  os层面线程生命周期

>   操作系统层面的线程生命周期基本上可以用下图这个“五态模型”来描述。这五态分别是：初始状态、就绪状态、运行状态、阻塞状态（休眠状态）和终止状态。

![image-20220319175504444](asserts/image-20220319175504444.png)

**初始态：**

>   这个状态属于编程语言特有的，不过这里所谓的被创建，仅仅是在编程语言层面被创建，而在操作系统层面，真正的线程还没有创建。（没有关联os）

**就绪状态：**

>   指的是线程可以分配 CPU 执行，其已经获取了出cpu以外的全部资源。

**休眠状态：**

>   运行状态的线程如果遇到阻塞事件，那么线程的状态就会转换到休眠状态，同时释放 CPU 使用权，休眠状态的线程永远没有机会获得 CPU 使用权。

**终止状态：**

>   线程正常执行结束，或者被迫强制退出。



### 2.2 Java线程生命周期

>   Java 语言中线程共有六种状态，分别是：
>
>   1.   **NEW（初始化状态**） ：线程new出来，还未调用start方法之前的状态
>   2.    **RUNNABLE（可运行状态+运行状态）**：线程对象调用start方法，线程已经与os关联了
>   3.   BLOCKED（阻塞状态） ：看下图
>   4.   WAITING（无时限等待）：看下图
>   5.   TIMED_WAITING（有时限等待） ：看下图
>   6.   **TERMINATED（终止状态）**：线程正常和非正常结束

![26544](asserts/26544.png)

